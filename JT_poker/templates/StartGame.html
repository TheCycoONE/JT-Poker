<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to the Game</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4lWBokfK4yn5x3AzlOJ3CkItT3EJwBMXgbp4lCxXKaOM8lucU3MyV4liCF2Br" crossorigin="anonymous">
</head>
<body>
<div class="container mt-3">
    <h1>Welcome to the Game</h1>
    <div id="messages" class="border rounded p-3 mb-3" style="height: 300px; overflow-y: scroll;">
        <!-- Messages will be appended here dynamically -->
    </div>
    <p>{{ game_output }}</p>
    <form id="game-form" method="post" action="{% url 'start_game' %}">
        {% csrf_token %}
        <button type="submit" name="play" class="btn btn-primary">Play</button>
        <button type="submit" name="spectate" class="btn btn-secondary">Spectate</button>
    </form>
</div>

<!-- Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script>
    const chatSocket = new WebSocket(
        'ws://' + window.location.host + '/ws/playPoker/'
    );

    chatSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        const messages = document.getElementById('messages');
        messages.innerHTML = '';  // Clear the existing messages
        data.messages.forEach(message => {
            const messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            messages.appendChild(messageDiv);
        });
        messages.scrollTop = messages.scrollHeight;
    };

    chatSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

    function startGame() {
        const playButton = document.querySelector('button[name="play"]');
        playButton.click();
    }

    function spectateGame() {
        const spectateButton = document.querySelector('button[name="spectate"]');
        spectateButton.click();
    }

    function updateMessages() {
        if (chatSocket.readyState === WebSocket.OPEN) {
            chatSocket.send(JSON.stringify({
                'type': 'update_messages'
            }));
        }
    }

    setInterval(updateMessages, 5000); // Update every 5 second
</script>
</body>
</html>
